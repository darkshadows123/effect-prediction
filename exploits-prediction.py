from elasticsearch import Elasticsearch
import collections
import json
es = Elasticsearch(['http://ec2-52-42-169-124.us-west-2.compute.amazonaws.com/es/'], http_auth=('effect', 'c@use!23'), port=80)

# def get_types():
#     return_string = ""
#     res = es.indices.get_mapping(index='effect')
#     temp = res['effect-malware']['mappings']
#     for each_key in temp.keys():
#         return_string += ( each_key + ' ' + get_count(each_key) + '\n')
#     return return_string
def convert(data):
    if isinstance(data, basestring):
        return data.encode('utf-8')
    elif isinstance(data, collections.Mapping):
        return dict(map(convert, data.iteritems()))
    elif isinstance(data, collections.Iterable):
        return type(data)(map(convert, data))
    else:
        return data
def extractAllCPEs(document):
    cves = []
    cpes = []
	if 'name' in document['_source']['exploitsVulnerability']:
        cves.append(document['_source']['exploitsVulnerability']['name'])
        for 
cve_list = []
def search_results(type1):
    res = es.search(index='effect/'+type1,body={"query": {"filtered": {"filter": {"exists": {"field": "exploitsVulnerability"}}}}})
    documents  = res['hits']['hits']
    for doc in documents:
    	doc = convert(doc)
    	cves = extractAllCVE(doc)
    	cve_list.append(cves)
    	if 'name' in x['_source']['exploitsVulnerability']:
    		print x['_source']['exploitsVulnerability']['name']
    	# print type(convert(x))
    	# print json.dumps(x)
search_results('exploit')